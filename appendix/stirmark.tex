\chapter{Stirmark for Audio Testautomation}
\label{ch:stirmarkaudio}

Da die CLI API von \textit{Stirmark for Audio} und besonders dessen Verlangen nach nich n채her definierten Streams  zu Verwirrungen f체hren kann, sei an dieser Stelle eine sehr kurze Version eines funktionierenden Bash-Skriptes f체r die automatische Testdurchf체hrung exemplarisch angegeben:
      
\lstset{escapeinside={\%*}{*)}}  
\begin{lstlisting}[language=bash]
#!/usr/bin/env bash

streamfile="teststream"
tooldir="../bin" # smfa2 and read_write_stream binary location

if [ $# -ne 3 ] ; then
   echo "usage: ./stirmark_test <testfile> <samplerate> <channels>"
   exit 1
fi

testfile=$1
samplerate=$2
channels=$3

attack_list=( "AddDynNoise:20", "AddSinus:900 1300", "Invert" )
			
# first convert the audio file to a stream
$tooldir/read_write_stream -f $testfile -c $channels > $streamfile
 
# run all attacks and convert results to audiofiles
for attack in "${attack_list[@]}" ; do
   attack_name=${attack%%:*}
   attack_param=${attack#*:}
   $tooldir/smfa2 --$attack_name $attack_param -s $samplerate < $streamfile | $tooldir/read_write_stream -p -s $samplerate -c $channels -f ${testfile%.wav}-attacked-$attack_name-${attack_param// /-}.wav
done
\end{lstlisting}









